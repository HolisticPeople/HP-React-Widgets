# HP-React-Widgets AI Funnel Instructions

## IMPORTANT: Funnel Creation System

When asked to create, modify, or build funnels, you MUST use the **HP-Abilities MCP Tools**, NOT the HP-Funnel-Bridge.

### Correct System: HP-Abilities (WordPress Abilities API)
- **Primary Method**: HP-Abilities MCP Tools (registered via WordPress Abilities API)
- **Fallback**: REST API at `/wp-json/hp-rw/v1/ai/`
- **Post Type**: `hp-funnel` (WordPress Custom Post Type)
- **MCP Server**: `woocommerce_mcp_staging` or `woocommerce_mcp_production`

### WRONG System: HP-Funnel-Bridge (DO NOT USE for funnel creation)
- HP-Funnel-Bridge is for connecting external React/Lovable funnels
- It is NOT for creating new funnels
- If you find yourself looking at "illumodine-boost-funnel" or similar Lovable projects, STOP

## MCP Abilities for Funnel Operations (PREFERRED)

Use these WordPress Abilities via MCP. They are exposed through the MCP Adapter plugin.

### System & Schema
| Ability | Purpose |
|---------|---------|
| `hp/funnels/explain-system` | Complete funnel system documentation |
| `hp/funnels/schema` | JSON schema with AI generation hints |
| `hp/funnels/styling-schema` | Styling presets and color palettes |

### Funnel CRUD
| Ability | Purpose |
|---------|---------|
| `hp/funnels/list` | List all funnels with metadata |
| `hp/funnels/get` | Get complete funnel by slug |
| `hp/funnels/create` | Create new funnel from JSON |
| `hp/funnels/update` | Update existing funnel |
| `hp/funnels/update-sections` | Update specific sections only |

### Version Control
| Ability | Purpose |
|---------|---------|
| `hp/funnels/versions/list` | List all versions of a funnel |
| `hp/funnels/versions/create` | Create backup before changes |
| `hp/funnels/versions/restore` | Restore to previous version |

### Products & Protocol
| Ability | Purpose |
|---------|---------|
| `hp/products/search` | Search products by category, name |
| `hp/products/get` | Get product details including servings |
| `hp/products/calculate-supply` | Calculate bottles needed for X days |
| `hp/protocols/build-kit` | Build product kit from health protocol |

### Economics
| Ability | Purpose |
|---------|---------|
| `hp/economics/calculate` | Calculate offer profitability |
| `hp/economics/validate` | Validate against economic guidelines |
| `hp/economics/guidelines` | Get/set min profit rules |

## How to Create a Funnel

### Step 1: Understand the System
Use ability: `hp/funnels/explain-system`
Returns complete documentation of funnel structure, sections, offer types, and styling.

### Step 2: Get Schema with AI Hints
Use ability: `hp/funnels/schema`
Returns JSON schema with AI generation hints for each section.

### Step 3: Get Reference Funnel (Optional)
Use ability: `hp/funnels/list` then `hp/funnels/get` with slug
Get an existing funnel as a reference template.

### Step 4: Search Products for the Kit
Use ability: `hp/products/search` with category filter
Use ability: `hp/products/get` with SKU for details

### Step 5: Build Kit from Protocol
Use ability: `hp/protocols/build-kit` with:
```json
{
  "supplements": [
    {"sku": "PRODUCT-SKU", "servings_per_day": 3}
  ],
  "duration_days": 90
}
```

### Step 6: Validate Economics
Use ability: `hp/economics/validate` with offer details
Ensures minimum profit margins are met.

### Step 7: Create Backup (for existing funnels)
Use ability: `hp/funnels/versions/create` before making changes

### Step 8: Create/Update the Funnel
Use ability: `hp/funnels/create` or `hp/funnels/update`
Pass complete funnel JSON conforming to hp-funnel/v1 schema.

## REST API Fallback

If MCP abilities are not available, use REST endpoints at `/wp-json/hp-rw/v1/ai/`:

| Endpoint | Method | Purpose |
|----------|--------|---------|
| `/ai/system/explain` | GET | Complete system documentation |
| `/ai/schema` | GET | JSON schema with AI hints |
| `/ai/funnels` | GET/POST | List or create funnels |
| `/ai/funnels/{slug}` | GET/PUT/DELETE | CRUD on specific funnel |
| `/ai/funnels/{slug}/versions` | GET/POST | Version control |
| `/ai/products` | GET | Search products |
| `/ai/protocols/build-kit` | POST | Build kit from protocol |
| `/ai/economics/validate-offer` | POST | Validate offer economics |

## Authentication

- **MCP Abilities**: Automatically authenticated via MCP Adapter
- **REST API**: Requires `manage_woocommerce` capability

Use MCP servers:
- Staging: `woocommerce_mcp_staging`
- Production: `woocommerce_mcp_production`

## Local Documentation

Full documentation: `HP-React-Widgets/docs/AI_FUNNEL_CREATION.md`

## Decision Points

When building funnels, present choices to the admin for:
- Offer structure (fixed_bundle vs customizable_kit)
- Discount strategy (percent_off vs fixed_discount)
- Headline style (benefit-focused vs problem-focused)
- Theme (dark vs light, accent color)
- Sections to include (minimal, standard, comprehensive)

Do NOT make autonomous decisions on these points.

## Architecture

```
Agent → MCP Protocol → MCP Adapter Plugin → WordPress Abilities API → HP-Abilities Plugin → HP-React-Widgets Services
```

HP-Abilities wraps calls to HP-React-Widgets services:
- FunnelSystemExplainer
- FunnelSchema
- ProductCatalogService
- ProtocolKitBuilder
- EconomicsService
- FunnelVersionControl
