# HP-React-Widgets Master Protocol

This file defines the mandatory rules and workflows for AI agents working on the HP-React-Widgets plugin and related WooCommerce ecosystems.

## 1. Core Guidelines (Amnon's Protocol)
- **Workflow**: Plan → Code → Review.
- **Brutal Honesty**: Be brutally honest about plan and execution.
- **Self-Sufficiency**: Always attempt to write code yourself; do not ask the user to manually edit files.
- **Documentation**: Place extra plans or reports in `\Plans and reports`.
- **Cleanup**: Remove `console.log()` and debug info after fixing, but preserve functionality.
- **Analysis**: Perform a detailed analysis of changes by comparing to previous versions.

## 2. WooCommerce Plugin Standards
- **Namespace**: `HP_RW\`
- **File Headers**: Must include standard WP plugin header (Name, Version, Author, etc.).
- **Security**:
  - Start all PHP files with `if (!defined('ABSPATH')) { exit; }`.
  - Sanitize all inputs (`sanitize_text_field()`, `absint()`, etc.).
  - Escape all outputs (`esc_html()`, `esc_attr()`, etc.).
  - Use nonces for all AJAX calls.
  - Check capabilities: `current_user_can('manage_woocommerce')`.
- **HPOS**: Always use HPOS-compatible order queries (`wc_get_orders()`).

## 3. Git & Deployment Workflow
- **Branching**: All work happens on the `dev` branch.
- **Commits**: Format as `v{version}: {description}`.
- **Deployment**: Pushing to `dev` auto-deploys to staging via GitHub Actions (~30s).
- **Versioning**: 
  - **IMPERATIVE**: Increment the plugin version in BOTH the header comment and the `HP_RW_VERSION` constant for EVERY change set.
  - Follow `Major.Feature.Patch` versioning (e.g., 2.32.16).

## 4. Architecture: Deeply Integrated Shortcodes
- **Pattern**: Transitioning from external bridges to React/Tailwind shortcodes within WordPress.
- **Shortcode Structure**:
  - PHP class in `includes/Shortcodes/`.
  - Enqueue assets only when shortcode is present.
  - Pass context (nonces, user ID) via `data-config` attributes.
- **React Hydration**: Main entry point `src/main.tsx` hydrates components based on IDs.

## 5. The Four Pillars
For every feature, ensure:
1. **Performance**: Lazy-load React, minimize bundles, FCP < 1.5s.
2. **Security**: No payment data in JS, strict nonce verification, sanitization.
3. **SEO**: Use ACF for structured data, ensure Yoast can see CPTs, semantic HTML.
4. **Analytics**: Push events to `dataLayer` (product view, add to cart, checkout steps).

## 6. ACF JSON Field Management
- **Source of Truth**: `acf-json/` folder.
- **No IDs**: Never include hardcoded `ID` values for new fields in JSON.
- **Auto-Sync**: Triggered on version change. Bump version to sync fields to the database.

## 7. Verification Workflow
After deployment, verify in order:
1. **MCP Queries**: Use `woocommerce-orders-list` etc. for data verification.
2. **SSH + WP-CLI**: Use `wp cache flush`, `wp option get` via SSH.
3. **Browser Automation**: Use for UI/UX testing and admin settings verification.

## 8. HP Abilities & MCP Protocol
- **Namespace**: Use `hp-abilities/` prefix for tools.
- **Registration**: Register tools in `wp_abilities_api_init` hook in `includes/Plugin.php`.
- **Health Check**: Always click "Check Health" in the Abilities Hub after adding tools.

## 9. Environment Details
- **Staging URL**: `https://env-holisticpeoplecom-hpdevplus.kinsta.cloud/wp-admin/`
- **SSH Host**: `35.236.219.140` (Port `12872`)
- **Shell**: Windows PowerShell (Use semicolons `;` for chaining, not `&&`).
